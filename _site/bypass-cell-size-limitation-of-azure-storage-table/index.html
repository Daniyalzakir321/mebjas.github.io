<!DOCTYPE html>
<html lang="en">
 <head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <meta name="google-site-verification" content="Xs4Y8kOjxCHZvery6v-Y6yVIptmWsSjownRLWpRDDlc" />
 <meta name="msvalidate.01" content="C21F82032619E6AE38AEC7FFE4D05827" />
<link rel="stylesheet" href=/assets/main.css>
<link rel="stylesheet" href=/assets/custom.css>
<link rel="alternate" type="application/rss+xml" title="Minhaz&#39;s Blog" href="/feed.xml">
<link rel="shortcut icon" href=/assets/favicon.ico>
<link rel="icon" type="image/png" sizes="32x32" href=/assets/favicon.ico>
  <script src="/assets/js/jquery.js"></script>
<title>Bypass cell size limitation (64KB) of Azure Storage Table | Minhaz’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="Bypass cell size limitation (64KB) of Azure Storage Table" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Azure Storage Table is Azure’s NoSQL offering to store large number of data (upto peta bytes) in a table (tables have rows and columns). It provides indexing on two keys namely partition key and row key which allows you to retrieve data efficiently. No other columns are indexed, but that’s expected behavior. It has limitations on size of a single row (1 MB), size of a single column (64KB), number of columns per row (255) and so on. While I don’t really know why some of them exist – they just do. In this article I have proposed a naughty but elegant way of bypassing this issue." />
<meta property="og:description" content="Azure Storage Table is Azure’s NoSQL offering to store large number of data (upto peta bytes) in a table (tables have rows and columns). It provides indexing on two keys namely partition key and row key which allows you to retrieve data efficiently. No other columns are indexed, but that’s expected behavior. It has limitations on size of a single row (1 MB), size of a single column (64KB), number of columns per row (255) and so on. While I don’t really know why some of them exist – they just do. In this article I have proposed a naughty but elegant way of bypassing this issue." />
<link rel="canonical" href="http://localhost:4000/bypass-cell-size-limitation-of-azure-storage-table/" />
<meta property="og:url" content="http://localhost:4000/bypass-cell-size-limitation-of-azure-storage-table/" />
<meta property="og:site_name" content="Minhaz’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2019-01-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Bypass cell size limitation (64KB) of Azure Storage Table" />
<meta name="twitter:site" content="@minhazav" />
<meta name="twitter:creator" content="@minhazav" />
<script type="application/ld+json">
{"headline":"Bypass cell size limitation (64KB) of Azure Storage Table","dateModified":"2019-01-06T00:00:00+00:00","datePublished":"2019-01-06T00:00:00+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.minhazav.dev/images/rsz_self_1_1.jpg"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/bypass-cell-size-limitation-of-azure-storage-table/"},"url":"http://localhost:4000/bypass-cell-size-limitation-of-azure-storage-table/","description":"Azure Storage Table is Azure’s NoSQL offering to store large number of data (upto peta bytes) in a table (tables have rows and columns). It provides indexing on two keys namely partition key and row key which allows you to retrieve data efficiently. No other columns are indexed, but that’s expected behavior. It has limitations on size of a single row (1 MB), size of a single column (64KB), number of columns per row (255) and so on. While I don’t really know why some of them exist – they just do. In this article I have proposed a naughty but elegant way of bypassing this issue.","@context":"https://schema.org"}</script>
</head>
 <body data-instant-allow-query-string data-instant-allow-external-links>
  <header class="site-header">
   <div class="wrapper-header">
     <div class="header-left">
       <div>
          <a class="site-title" href="/">
            <b>Minhaz's Blog</b>
          </a>
       </div>
       <div>
          <a class="site-subtitle" href="/">
            <b>Hack your way out!</b>
          </a>
       </div>
     </div>
     <div class="header-right">
        <a class="page-link" href="https://github.com/mebjas">Github</a>
        <a class="page-link" href="https://www.linkedin.com/in/minhazav">LinkedIn</a>
        <a class="page-link" href="/about/">About Me</a>
        <a class="page-link" href="/photography/">Photography</a>
     </div>
   </div>
 </header>
   <main class="default-content" aria-label="Content">
     <div class="wrapper-content">
       <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<header class="page-header">
   <h1 class="post-title" itemprop="name headline">Bypass cell size limitation (64KB) of Azure Storage Table</h1>
   <p class="post-meta">
      <time datetime="2019-01-06T00:00:00+00:00" itemprop="datePublished">
        Jan 6, 2019
      </time>
      •
<a class="category-link" href="/category/architecture/" rel="category">architecture</a> 
<a class="category-link" href="/category/system-design/" rel="category">system-design</a> 
<a class="category-link" href="/category/azure/" rel="category">azure</a> 
<a class="category-link" href="/category/azure-storage-table/" rel="category">azure-storage-table</a> 
<a class="category-link" href="/category/compression/" rel="category">compression</a> 
<a class="category-link" href="/category/distributed-systems/" rel="category">distributed-systems</a> 
<a class="category-link" href="/category/microsoft/" rel="category">microsoft</a> 
<a class="category-link" href="/category/open-source/" rel="category">open-source</a> 
<a class="category-link" href="/category/cloud/" rel="category">cloud</a> 
   </p>
 </header>
 <div class="post-content" itemprop="articleBody">
   <h2 id="introduction">Introduction</h2>
<p>Azure Storage Table is Azure’s NoSQL offering to store large number of data (upto peta bytes) in a table (tables have rows and columns). It provides indexing on two keys namely partition key and row key which allows you to retrieve data efficiently. No other columns are indexed, but that’s expected behavior. Azure Storage is dirt cheap – it costs like <code class="highlighter-rouge">$0.07 per GB / month</code> for locally redundant storage model. It promotes creating multiple redundant copies of the data so that you don’t need foreign keys or so anymore. Not requiring any schema upfront gives this flexibility.</p>
<h2 id="problem">Problem</h2>
<p><strong>Azure Storage Table was not created by God, it was created by folks like us (much smarter though)</strong>. It has limitations on size of a single row (1 MB), size of a single column (64KB), number of columns per row (255) and so on. While I don’t really know why some of them exist – they just do.</p>
<p>One of them that really tickled me off recently was a limitation of 64K size of cell size. On top of that, if it’s a <code class="highlighter-rouge">string type</code> it supports only <code class="highlighter-rouge">32K characters</code>.  They have documented this in some mystical way I couldn’t understand much.</p>
<blockquote>
 <p>A UTF-16-encoded value. String values may be up to 64 KB in size. Note that the maximum number of characters supported is about 32 K or less.</p>
</blockquote>
<p>Reference: <a href="https://docs.microsoft.com/en-us/rest/api/storageservices/Understanding-the-Table-Service-Data-Model?redirectedfrom=MSDN#tables-entities-and-properties">MSDN Article  Understanding the Table Service Data Model</a></p>
<p><img src="../images/post9_image2.png" alt="" width="300px" /><br />
With a bhushshshs!</p>
<h2 id="the-solution">The solution</h2>
<p>Now if you have a requirement of storing data as rows referenced by a Partition Key and Row Key, and want to store data larger that 32K in a single column – you can do one of these:</p>
<h3 id="1-put-data-to-blob-and-link-to-table-bla-bla-bla">1. Put data to blob and link to table bla bla bla</h3>
<p>This is what everyone else would tell you:</p>
<blockquote>
 <p>Put data in a blob, and put blob details in a cell.</p>
</blockquote>
<p>I dont like this option – I hate the cost of making another network calls. It adds latency, it reduces my availability numbers, adds more dependency and thus more scope of failure. And if that is not enough – this happens with both Read and Write operation. I don’t like this approach, I won’t follow it unless I have no other option.</p>
<h3 id="2-the-smarter-way">2. The smarter way</h3>
<p>Well, lets compress the data, split it into multiple chunks of <code class="highlighter-rouge">32K columns</code>, construct a metadata with information just enough to reconstruct this data when reading and put it all to a single row.</p>
<ul>
 <li>Single network call</li>
 <li>Lower latency</li>
 <li>Lower chances of failure.</li>
</ul>
<p>You can find reference to my code implementation below. Following diagram explains this simple concept in a fancy way, which I know is not really required.</p>
<p><img src="../images/post9_image1.png" alt="reference desing" width="750px" /><br />
<span class="image-caption"><em>Figure: Reference design to compress, split, store, retrieve, reconstruct, decompress and yeyy!</em></span></p>
<h4 id="but-if">But if,</h4>
<blockquote>
 <p>But Minhaz, my data is bigger than 1MB even after compression? Now what?</p>
</blockquote>
<p><strong>– Some random guy</strong></p>
<p>Oh, in that case maybe option one. Maybe don’t reveal my worries to the manager. Or, maybe take the approach mentioned in point two and extend it to rows and leverage Bulk Read and Bulk Write APIs of Azure Storage Table. That would be cool!</p>
<p>It’s just, whenever possible avoid multiple network (or API) calls. And yes I am aware of all async paradigms – I’d still say, resources are always limited.</p>
<h2 id="summary">Summary</h2>
<p>If you intend to store data like <code class="highlighter-rouge">1.5MB</code> in size in Azure Storage Table in a single column, you can use option two. One of the scenario is for those who want to use Azure Storage Table as key value pair.</p>
<h2 id="references">References</h2>
<ol>
 <li>Implementation on 
Github - <a href="https://github.com/mebjas/AzureStorageTableLargeDataWriter/blob/master/AzureStorageTableLargeDataWriter/StorageTableWriter.cs">mebjas/AzureStorageTableLargeDataWriter</a></li>
 <li><a href="https://feedback.azure.com/forums/217298-storage/suggestions/1623951-extend-table-storage-property-limit">Extend Table Storage Property Limit (Azure Feedback)</a></li>
 <li>Currently, Azure Tables only support 255 properties (columns) on a single entity (row) and a max row size of 1MB. This should be greatly extended (e.g. 10x+), particularly since Azure does not offer Join query support.</li>
 <li>Limit to the column size in azure table : <a href="https://stackoverflow.com/questions/44840195/limit-to-the-column-size-in-azure-table">Stack Overflow</a></li>
 <li><a href="https://medium.com/@madhufuture/azure-table-storage-column-size-limitations-and-alternative-approach-for-storing-large-data-9279eb301c7b">Some alternative approaches</a></li>
</ol>
 </div>
 <div class="post-footer">
<div class="related-posts">
  <span class="related-posts-text">Related posts:</span>
 <ul>
 </ul>
</div>
<div class="post-filed">
   <p class="post-meta">
      Filed under
<a class="category-link" href="/category/architecture/" rel="category">architecture</a>
<a class="category-link" href="/category/system-design/" rel="category">system-design</a>
<a class="category-link" href="/category/azure/" rel="category">azure</a>
<a class="category-link" href="/category/azure-storage-table/" rel="category">azure-storage-table</a>
<a class="category-link" href="/category/compression/" rel="category">compression</a>
<a class="category-link" href="/category/distributed-systems/" rel="category">distributed-systems</a>
<a class="category-link" href="/category/microsoft/" rel="category">microsoft</a>
<a class="category-link" href="/category/open-source/" rel="category">open-source</a>
<a class="category-link" href="/category/cloud/" rel="category">cloud</a>
   </p>
   <p>
      <a href="#top">top&nbsp;&#8673;</a>
   </p>
 </div>
<div class="post-nav">
   <p>
      <a href="/efficiently-writing-large-objects-to-azure-blob-storage-json-compression-caching-streaming-in-net/">&#8672;&nbsp;Efficiently writing large objects to Azure Blob Storage – JSON, Compression, Caching, Streaming in .Net</a>
   </p>
   <p>
      <a href="/interview-tips-1-in-a-coding-interview-use-abstractions/">Interview tips 1 – In a coding interview use abstractions!&nbsp;&#8674;</a>
   </p>
 </div>
<div style="border-top: 1px solid #cfcfcf; margin-top: 30px">
   <div class="widget-self">
   <div class="section-image">
        <a href="/about">
            <img src="/images/rsz_self_1_1.jpg" width="200px">
        </a>
   </div>
   <div class="section-info">
        <strong><a href="/about">Minhaz | Google | Singapore</a></strong>
       <div class="quote">
            I am working with Next Billion Users Org at Google. My team builds technologies for emerging markets.
            I feel, the goal of delivering cutting edge technologies to resource constrained devices with seamless performance is hard, at times frustating but worthwhile.
            Hoping for positive impact, good Karma and unbounded learning ;)
       </div>
       <div class="quote">
            These days I am working on #Computational-Photography and try hard at #Photography as well.
            I have good experience with #Distributed-Systems and #Applied-ML.
       </div>
   </div>
</div>
</div>
 </div>
 <div class="just-comments" data-apikey="014acd23-9a26-4415-a7ea-80f4253d1295" data-recaptcha="true"></div>
  <script async src="https://just-comments.com/w2.js"></script>
</article>
     </div>
   </main>
   <footer class="site-footer">
   <div class="wrapper-footer">
     <div class="footer-col-wrapper">
<a href="mailto:minhazav@gmail.com"><i class="svg-icon email"></i></a>
<a href="http://github.com/mebjas"><i class="svg-icon github"></i></a>
<a href="http://instagram.com/mebjas"><i class="svg-icon instagram"></i></a>
<a href="http://linkedin.com/in/https://www.linkedin.com/in/minhazav"><i class="svg-icon linkedin"></i></a>
<a href="http://twitter.com/minhazav"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/2614250/mebjas"><i class="svg-icon stackoverflow"></i></a>
     </div>
     <div class="copyright">
        © 2019 minhazav.dev
     </div>
   </div>
    <script src="/assets/js/anchorize.js"></script>
 </footer>
    <script src="/assets/js/instantpage.js" type="module" integrity="sha384-/IkE5iZAM/RxPto8B0nvKlMzIyCWtYocF01PbGGp1qElJuxv9J4whdWBRtzZltWn"></script>
 </body>
</html>
