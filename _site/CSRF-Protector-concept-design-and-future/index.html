<!DOCTYPE html>
<html lang="en">
 <head>
 <meta charset="utf-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1">
 <meta name="google-site-verification" content="Xs4Y8kOjxCHZvery6v-Y6yVIptmWsSjownRLWpRDDlc" />
 <meta name="msvalidate.01" content="C21F82032619E6AE38AEC7FFE4D05827" />
<link rel="stylesheet" href=/assets/main.css>
<link rel="stylesheet" href=/assets/custom.css>
<link rel="alternate" type="application/rss+xml" title="Minhaz&#39;s Blog" href="/feed.xml">
<link rel="shortcut icon" href=/assets/favicon.ico>
<link rel="icon" type="image/png" sizes="32x32" href=/assets/favicon.ico>
  <script src="/assets/js/jquery.js"></script>
<title>CSRF protector – Concept, Design and Future | Minhaz’s Blog</title>
<meta name="generator" content="Jekyll v4.0.0" />
<meta property="og:title" content="CSRF protector – Concept, Design and Future" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="CSRF has been on OWASP Top 10 for a long time, and several methods have been implemented to mitigate it. Most of the web frameworks have inbuilt methods, which can be used to make a website safe against CSRF. However lot of web applications are still vulnerable to CSRF and its partially because developer tend to forget to implement it with every FORM or AJAX requests. And that is because the approach used for CSRF Mitigation in most of the frameworks is not centralised, we have to attach a token with every FORM we want to protect. OWASP CSRF Protector on the other hand used centralised approach, it employs javascript on client side to ensure, tokens are sent with every request sent from client, so that is correctly validated on server. This saves developer from adding a token everywhere. I’ll discuss more about the concept later in this article." />
<meta property="og:description" content="CSRF has been on OWASP Top 10 for a long time, and several methods have been implemented to mitigate it. Most of the web frameworks have inbuilt methods, which can be used to make a website safe against CSRF. However lot of web applications are still vulnerable to CSRF and its partially because developer tend to forget to implement it with every FORM or AJAX requests. And that is because the approach used for CSRF Mitigation in most of the frameworks is not centralised, we have to attach a token with every FORM we want to protect. OWASP CSRF Protector on the other hand used centralised approach, it employs javascript on client side to ensure, tokens are sent with every request sent from client, so that is correctly validated on server. This saves developer from adding a token everywhere. I’ll discuss more about the concept later in this article." />
<link rel="canonical" href="http://localhost:4000/CSRF-Protector-concept-design-and-future/" />
<meta property="og:url" content="http://localhost:4000/CSRF-Protector-concept-design-and-future/" />
<meta property="og:site_name" content="Minhaz’s Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-11-28T00:00:00+00:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CSRF protector – Concept, Design and Future" />
<meta name="twitter:site" content="@minhazav" />
<meta name="twitter:creator" content="@minhazav" />
<script type="application/ld+json">
{"headline":"CSRF protector – Concept, Design and Future","dateModified":"2015-11-28T00:00:00+00:00","datePublished":"2015-11-28T00:00:00+00:00","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://blog.minhazav.dev/images/rsz_self_1_1.jpg"}},"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/CSRF-Protector-concept-design-and-future/"},"url":"http://localhost:4000/CSRF-Protector-concept-design-and-future/","description":"CSRF has been on OWASP Top 10 for a long time, and several methods have been implemented to mitigate it. Most of the web frameworks have inbuilt methods, which can be used to make a website safe against CSRF. However lot of web applications are still vulnerable to CSRF and its partially because developer tend to forget to implement it with every FORM or AJAX requests. And that is because the approach used for CSRF Mitigation in most of the frameworks is not centralised, we have to attach a token with every FORM we want to protect. OWASP CSRF Protector on the other hand used centralised approach, it employs javascript on client side to ensure, tokens are sent with every request sent from client, so that is correctly validated on server. This saves developer from adding a token everywhere. I’ll discuss more about the concept later in this article.","@context":"https://schema.org"}</script>
</head>
 <body data-instant-allow-query-string data-instant-allow-external-links>
  <header class="site-header">
   <div class="wrapper-header">
     <div class="header-left">
       <div>
          <a class="site-title" href="/">
            <b>Minhaz's Blog</b>
          </a>
       </div>
       <div>
          <a class="site-subtitle" href="/">
            <b>Hack your way out!</b>
          </a>
       </div>
     </div>
     <div class="header-right">
        <a class="page-link" href="https://github.com/mebjas">Github</a>
        <a class="page-link" href="https://www.linkedin.com/in/minhazav">LinkedIn</a>
        <a class="page-link" href="/about/">About Me</a>
        <a class="page-link" href="/photography/">Photography</a>
     </div>
   </div>
 </header>
   <main class="default-content" aria-label="Content">
     <div class="wrapper-content">
       <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<header class="page-header">
   <h1 class="post-title" itemprop="name headline">CSRF protector – Concept, Design and Future</h1>
   <p class="post-meta">
      <time datetime="2015-11-28T00:00:00+00:00" itemprop="datePublished">
        Nov 28, 2015
      </time>
      •
<a class="category-link" href="/category/csrf/" rel="category">csrf</a> 
<a class="category-link" href="/category/javascript/" rel="category">javascript</a> 
<a class="category-link" href="/category/open-source/" rel="category">open-source</a> 
<a class="category-link" href="/category/owasp/" rel="category">owasp</a> 
<a class="category-link" href="/category/security/" rel="category">security</a> 
<a class="category-link" href="/category/web-security/" rel="category">web-security</a> 
<a class="category-link" href="/category/php/" rel="category">php</a> 
<a class="category-link" href="/category/apache/" rel="category">apache</a> 
   </p>
 </header>
 <div class="post-content" itemprop="articleBody">
   <h2 id="csrf--cross-site-request-forgery">CSRF – Cross Site Request Forgery</h2>
<blockquote>
 <p><em>Cross-Site Request Forgery (CSRF) is a type of attack that occurs when a malicious Web site, email, blog, instant message, or program causes a user’s Web browser to perform an unwanted action on a trusted site for which the user is currently authenticated. The impact of a successful cross-site request forgery attack is limited to the capabilities exposed by the vulnerable application. For example, this attack could result in a transfer of funds, changing a password, or purchasing an item in the user’s context. In effect, CSRF attacks are used by an attacker to make a target system perform a function (funds Transfer, form submission etc.) via the target’s browser without knowledge of the target user, at least until the unauthorised function has been committed.</em></p>
</blockquote>
<p>from <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_(CSRF)_Prevention_Cheat_Sheet">OWASP WIKI</a></p>
<h2 id="introduction">Introduction</h2>
<p><img src="../images/post3_image1.jpg" alt="Introduction" width="750px" /></p>
<p>CSRF has been on OWASP Top 10 for a long time, and several methods have been implemented to mitigate it. Most of the web frameworks have inbuilt methods, which can be used to make a website safe against CSRF.</p>
<p>However lot of web applications are still vulnerable to CSRF and its partially because developer tend to forget to implement it with every FORM or AJAX requests. And that is because the approach used for CSRF Mitigation in most of the frameworks is not centralised, we have to attach a token with every FORM we want to protect. OWASP CSRF Protector on the other hand used centralised approach, it employs javascript on client side to ensure, tokens are sent with every request sent from client, so that is correctly validated on server. This saves developer from adding a token everywhere. I’ll discuss more about the concept later in this article.</p>
<p>I did my Google Summer of Code in 2014 with OWASP Foundation on CSRF Protector Project, which introduced an easy way to mitigate CSRF in web application. Its based on a research paper “<a href="http://seclab.cs.sunysb.edu/seclab/pubs/acsac11.pdf">A Server- and Browser-Transparent CSRF Defense for Web 2.0 Applications</a>” by Riccardo Pelizzi and R Sekar . The project was implemented in two part:</p>
<ul>
 <li><a href="https://github.com/mebjas/CSRF-Protector-PHP">Standalone PHP library</a>: A super cool (easy) plug and play library for PHP projects and frameworks. Just follow these steps:
   <ul>
     <li>Download the library!</li>
     <li>Configure it, by simply modifying the config file.</li>
     <li>In your code include the library: <code class="highlighter-rouge">include __DIR__ .'/path/to/library/file';</code></li>
     <li>Call the init method: <code class="highlighter-rouge">csrfprotector::init();</code></li>
   </ul>
 </li>
 <li><a href="http://github.com/mebjas/mod_csrfprotector">Apache 2.2.x module</a>: If you are a server administrator and wish to mitigate CSRF without changing a single line of code, simply install this apache module and you are good to go!.</li>
</ul>
<h2 id="concept">Concept</h2>
<p>The concept is pretty cool. It takes advantage of the <strong>same origin policy of the cookies</strong>, which makes sure only scripts running on the web page can access cookies associated with that domain. Now what happens is when ever a script is run, which includes the library, <strong>it validates</strong> the incoming request for CSRF Tokens. I’ll cover concept of validation later. So lets us assume the validation is successful, it starts buffering the output generated by the application and at the end, it check if its a HTML output, and on success it attaches the javascript code, and some other metadata to the output using regex replace method. A new token is generated each time its consumed, i.e. on successful validation. So this new token is stored as a list in SESSION variables, and sent to the client as cookie.</p>
<p>The javascript code running on the client side, creates a wrapper around the <strong>XMLHttpRequest</strong> class (used for AJAX request), defined in javascript which makes sure whenever a POST or GET request is sent the token is picked from cookie and attached with the request payload. Similarly it attaches a listener around every FORM element, and creates a wrapper around HTMLFormElement submit method. So javascript code makes sure, it attaches a token to every request that is generated from the client, that needs validation. By need validation it means, every POST request and certain GET requests which are specified in the config file of the library.</p>
<h3 id="validation">Validation</h3>
<p>When a request is recieved, it goes through the input filter of the library and there the token sent in the payload is compared with one stored in the session variable. If successfully matched, all tokens older to that are removed from server and new token is generated. If the validation fails, one of the few actions specified (it can be changed in the config file) is taken and the event is logged.</p>
<p>Conclusion is, its pretty easy to use: <strong>Download, Configure, Include, Smile!</strong></p>
<p>I recently implemented a lighter version of the library. and its used by <a href="https://todofy.org/">todofy</a>, . it brings certain performance improvement over the original once, but is comparatively difficult to implement. Code available open source at Github <a href="https://github.com/todofy/CSRF-Protector-PHP-LITE">todofy/CSRF-Protector-PHP-LITE</a></p>
<h2 id="references">References</h2>
<ol>
 <li>OWASP Wiki on CSRF Protector: https://www.owasp.org/index.php/CSRFProtector_Project</li>
 <li>Github: CSRF Protector PHP: https://github.com/mebjas/CSRF-Protector-PHP/</li>
 <li>Github: mod_csrfprotector: http://github.com/mebjas/mod_csrfprotector</li>
 <li>Research Paper: A Server- and Browser-Transparent CSRF Defense for Web 2.0 Applications</li>
 <li>CSRF Protector PHP Lite by todofy – https://github.com/todofy/CSRF-Protector-PHP-LITE</li>
</ol>
 </div>
 <div class="post-footer">
<div class="related-posts">
  <span class="related-posts-text">Related posts:</span>
 <ul>
 </ul>
</div>
<div class="post-filed">
   <p class="post-meta">
      Filed under
<a class="category-link" href="/category/csrf/" rel="category">csrf</a>
<a class="category-link" href="/category/javascript/" rel="category">javascript</a>
<a class="category-link" href="/category/open-source/" rel="category">open-source</a>
<a class="category-link" href="/category/owasp/" rel="category">owasp</a>
<a class="category-link" href="/category/security/" rel="category">security</a>
<a class="category-link" href="/category/web-security/" rel="category">web-security</a>
<a class="category-link" href="/category/php/" rel="category">php</a>
<a class="category-link" href="/category/apache/" rel="category">apache</a>
   </p>
   <p>
      <a href="#top">top&nbsp;&#8673;</a>
   </p>
 </div>
<div class="post-nav">
   <p>
      <a href="/Drawing-a-3d-surface-patch-using-Bezier-equations/">&#8672;&nbsp;Drawing a 3d surface patch using Bezier equations</a>
   </p>
   <p>
      <a href="/logging-out-and-then-logging-in-throws-403-error-with-csrf-protector/">Logging out and then logging in throws 403 error with CSRF Protector PHP – fix / workaround&nbsp;&#8674;</a>
   </p>
 </div>
<div style="border-top: 1px solid #cfcfcf; margin-top: 30px">
   <div class="widget-self">
   <div class="section-image">
        <a href="/about">
            <img src="/images/rsz_self_1_1.jpg" width="200px">
        </a>
   </div>
   <div class="section-info">
        <strong><a href="/about">Minhaz | Google | Singapore</a></strong>
       <div class="quote">
            I am working with Next Billion Users Org at Google. My team builds technologies for emerging markets.
            I feel, the goal of delivering cutting edge technologies to resource constrained devices with seamless performance is hard, at times frustating but worthwhile.
            Hoping for positive impact, good Karma and unbounded learning ;)
       </div>
       <div class="quote">
            These days I am working on #Computational-Photography and try hard at #Photography as well.
            I have good experience with #Distributed-Systems and #Applied-ML.
       </div>
   </div>
</div>
</div>
 </div>
 <div class="just-comments" data-apikey="014acd23-9a26-4415-a7ea-80f4253d1295" data-recaptcha="true"></div>
  <script async src="https://just-comments.com/w2.js"></script>
</article>
     </div>
   </main>
   <footer class="site-footer">
   <div class="wrapper-footer">
     <div class="footer-col-wrapper">
<a href="mailto:minhazav@gmail.com"><i class="svg-icon email"></i></a>
<a href="http://github.com/mebjas"><i class="svg-icon github"></i></a>
<a href="http://instagram.com/mebjas"><i class="svg-icon instagram"></i></a>
<a href="http://linkedin.com/in/https://www.linkedin.com/in/minhazav"><i class="svg-icon linkedin"></i></a>
<a href="http://twitter.com/minhazav"><i class="svg-icon twitter"></i></a>
<a href="http://stackoverflow.com/users/2614250/mebjas"><i class="svg-icon stackoverflow"></i></a>
     </div>
     <div class="copyright">
        © 2019 minhazav.dev
     </div>
   </div>
    <script src="/assets/js/anchorize.js"></script>
 </footer>
    <script src="/assets/js/instantpage.js" type="module" integrity="sha384-/IkE5iZAM/RxPto8B0nvKlMzIyCWtYocF01PbGGp1qElJuxv9J4whdWBRtzZltWn"></script>
 </body>
</html>
